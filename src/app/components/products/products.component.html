<div class="products-container">
  <div class="products-card">
    <div class="header-section">
      <h1 class="title">Tambah Barang Baru</h1>
      <p class="subtitle">Sistem Inventaris Toko</p>
    </div>

    <form class="product-form" (submit)="onSubmit($event)">
      <div class="scanner-wrapper">
        <div class="scanner-box" [class.active]="isScanning">
          <div id="barcode-scanner" class="scanner-element"></div>

          <div *ngIf="!isScanning" class="scanner-placeholder" (click)="toggleScanner()">
            <div class="placeholder-content">
              <div class="icon-circle">
                <span>ðŸ“·</span>
              </div>
              <h3>Mulai Scan Barcode</h3>
              <p>Ketuk di sini untuk kamera belakang</p>
            </div>
          </div>

          <div class="scanner-overlay" *ngIf="isScanning">
            <div class="scan-area">
              <div class="laser-line"></div>
              <div class="corner-markers"><span></span><span></span><span></span><span></span></div>
            </div>
            <p class="scan-instruction">Arahkan barcode ke dalam kotak</p>

            <div class="scanner-controls-floating">
              <button
                type="button"
                class="ctrl-btn flash-btn"
                *ngIf="flashAvailable"
                [class.active]="isFlashOn"
                (click)="toggleFlash()"
                title="Lampu Flash"
              >
                âš¡
              </button>

              <button type="button" class="ctrl-btn stop-btn" (click)="toggleScanner()">
                Batal
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="scanError" [class]="getMessageClass()">
          {{ scanError }}
        </div>
      </div>

      <div class="manual-input-section">
        <div class="input-with-button">
          <input
            type="text"
            class="form-input"
            [(ngModel)]="product.barcode"
            name="barcode"
            placeholder="Atau ketik barcode manual..."
            (input)="onBarcodeInput()"
          />
          <button type="button" class="btn-check" (click)="manualBarcodeEntry()">Cek</button>
        </div>
      </div>

      <hr class="divider" />

      <div class="form-section">
        <h3 class="section-title">Detail Produk</h3>

        <div class="form-row">
          <div class="form-group">
            <label>Nama Produk <span class="required">*</span></label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="product.name"
              name="name"
              required
              placeholder="Contoh: Indomie Goreng"
            />
          </div>

          <div class="form-group">
            <label>Kategori</label>
            <select class="form-input" [(ngModel)]="product.category" name="category">
              <option value="">Pilih Kategori</option>
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
          </div>
        </div>

        <div class="form-row three-cols">
          <div class="form-group">
            <label>Harga Jual <span class="required">*</span></label>
            <div class="input-currency-wrapper">
              <span class="currency-prefix">Rp</span>
              <input
                type="text"
                class="form-input currency-input"
                [(ngModel)]="formattedPrice"
                (input)="onPriceInput($event)"
                name="price"
                placeholder="0"
                required
                autocomplete="off"
              />
            </div>
          </div>

          <div class="form-group">
            <label>Stok Awal <span class="required">*</span></label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="product.stock"
              name="stock"
              required
              min="0"
              placeholder="0"
            />
          </div>

          <div class="form-group">
            <label>Min. Stok</label>
            <input
              type="number"
              class="form-input"
              [(ngModel)]="product.minStock"
              name="minStock"
              min="0"
              placeholder="0"
            />
          </div>
        </div>

        <div class="form-group">
          <label>Supplier</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="product.supplier"
            name="supplier"
            placeholder="Nama Supplier"
          />
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="goToDashboard()">Kembali</button>
        <button type="submit" class="btn-primary">Simpan Produk</button>
      </div>
    </form>
  </div>
</div>
