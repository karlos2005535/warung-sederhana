<div class="products-container">
  <div class="products-card">
    <div class="header-section">
      <h1 class="title">Tambah Barang Baru</h1>
      <p class="subtitle">Toko Pak Baco - Kios Sembako Khas Indonesia</p>
    </div>

    <form class="product-form" (submit)="onSubmit($event)">
      <!-- Barcode Section -->
      <div class="form-section">
        <h3 class="section-title">Scan Barcode</h3>

        <div class="barcode-section">
          <div class="scanner-container">
            <div id="barcode-scanner" class="scanner-element"></div>
            <div *ngIf="!isScanning" class="scanner-placeholder">
              <i class="scanner-icon">ðŸ“·</i>
              <p>Klik tombol scan untuk memulai</p>
              <small>Scanner akan menggunakan kamera belakang</small>
            </div>

            <!-- Scanner Overlay dengan Bentuk Bard -->
            <div class="scanner-overlay" *ngIf="isScanning">
              <div class="scanner-frame-bard">
                <div class="scan-line-bard"></div>
                <div class="guide-text">Arahkan barcode ke dalam area ini</div>
              </div>
            </div>

            <!-- Scanner Controls Overlay -->
            <div class="scanner-controls-overlay" *ngIf="isScanning">
              <button
                type="button"
                class="btn-flash-overlay"
                (click)="toggleFlash()"
                *ngIf="flashAvailable"
                [class.active]="isFlashOn"
              >
                {{ isFlashOn ? 'ðŸ”¦' : 'âš¡' }}
              </button>
              <button
                type="button"
                class="btn-switch-camera"
                (click)="switchCamera()"
                *ngIf="hasMultipleCameras"
              >
                ðŸ”„
              </button>
            </div>
          </div>

          <div class="scanner-controls">
            <div class="scanner-buttons">
              <button type="button" class="btn-scan" (click)="toggleScanner()">
                {{ isScanning ? 'Stop Scan' : 'Scan Barcode' }}
              </button>
            </div>

            <div class="manual-entry">
              <label>Atau masukkan barcode manual:</label>
              <div class="input-group">
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="product.barcode"
                  name="barcode"
                  placeholder="Masukkan kode barcode"
                  (input)="onBarcodeInput()"
                />
                <button type="button" class="btn-check" (click)="manualBarcodeEntry()">Cek</button>
              </div>
            </div>

            <div
              *ngIf="scanError"
              class="message"
              [class.error-message]="
                scanError.includes('Gagal') ||
                scanError.includes('sudah') ||
                scanError.includes('tidak tersedia')
              "
              [class.success-message]="scanError.includes('berhasil')"
            >
              {{ scanError }}
            </div>

            <div class="scanner-tips">
              <h4>Tips Scanning:</h4>
              <ul>
                <li>Pastikan barcode sejajar dengan garis scanner</li>
                <li>Jaga jarak 10-20 cm dari kamera</li>
                <li>Pastikan barcode tidak terlipat atau rusak</li>
                <li>Gunakan flash jika kondisi gelap</li>
                <li>Pindai barcode secara horizontal</li>
              </ul>
            </div>

            <div class="scanner-info" *ngIf="isScanning">
              <div class="info-item">
                <span class="info-label">Status:</span>
                <span class="info-value">Mencari barcode...</span>
              </div>
              <div class="info-item">
                <span class="info-label">Kamera:</span>
                <span class="info-value">{{ currentCamera }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Details Section -->
      <div class="form-section">
        <h3 class="section-title">Detail Produk</h3>

        <div class="form-group">
          <label for="barcode">Kode Barcode *</label>
          <input
            type="text"
            id="barcode"
            class="form-input"
            [(ngModel)]="product.barcode"
            name="barcode"
            placeholder="Kode barcode akan terisi otomatis setelah scan"
            required
            readonly
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="name">Nama Produk *</label>
            <input
              type="text"
              id="name"
              class="form-input"
              [(ngModel)]="product.name"
              name="name"
              placeholder="Masukkan nama produk"
              required
            />
          </div>

          <div class="form-group">
            <label for="category">Kategori</label>
            <select id="category" class="form-input" [(ngModel)]="product.category" name="category">
              <option value="">Pilih Kategori</option>
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="price">Harga Jual (Rp) *</label>
            <input
              type="number"
              id="price"
              class="form-input"
              [(ngModel)]="product.price"
              name="price"
              placeholder="0"
              min="0"
              required
            />
          </div>

          <div class="form-group">
            <label for="stock">Stok Awal *</label>
            <input
              type="number"
              id="stock"
              class="form-input"
              [(ngModel)]="product.stock"
              name="stock"
              placeholder="0"
              min="0"
              required
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="minStock">Stok Minimum</label>
            <input
              type="number"
              id="minStock"
              class="form-input"
              [(ngModel)]="product.minStock"
              name="minStock"
              placeholder="0"
              min="0"
            />
            <small class="help-text">Akan muncul peringatan ketika stok mencapai jumlah ini</small>
          </div>

          <div class="form-group">
            <label for="supplier">Supplier</label>
            <input
              type="text"
              id="supplier"
              class="form-input"
              [(ngModel)]="product.supplier"
              name="supplier"
              placeholder="Nama supplier"
            />
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="goToDashboard()">Kembali</button>
        <button type="button" class="btn-outline" (click)="goToProductsList()">
          Lihat Daftar Barang
        </button>
        <button type="submit" class="btn-primary">Simpan Produk</button>
      </div>
    </form>
  </div>
</div>
