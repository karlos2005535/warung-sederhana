<div class="products-list-container">
  <div class="products-list-header">
    <h1>ğŸ“‹ Daftar Semua Produk</h1>
    <div class="header-actions">
      <button class="btn-back" (click)="goBack()">â† Kembali ke Dashboard</button>
      <button class="btn-add" (click)="goToAddProduct()">â• Tambah Produk Baru</button>
    </div>
  </div>

  <!-- Filter dan Pencarian -->
  <div class="filters-section">
    <div class="search-container">
      <div class="search-box">
        <input
          type="text"
          placeholder="Cari produk atau barcode..."
          [(ngModel)]="searchTerm"
          (input)="filterProducts()"
        />
        <span class="search-icon">ğŸ”</span>
      </div>

      <!-- Barcode Scan Button -->
      <div class="barcode-search-actions">
        <button class="btn-scan" (click)="startBarcodeScanner()">ğŸ“· Scan Barcode</button>
        <button class="btn-manual-barcode" (click)="manualBarcodeSearch()">ğŸ”¢ Input Barcode</button>
      </div>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="selectedCategory" (change)="filterProducts()">
        <option value="">Semua Kategori</option>
        <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
      </select>

      <select [(ngModel)]="stockFilter" (change)="filterProducts()">
        <option value="all">Semua Stok</option>
        <option value="low">Stok Rendah</option>
        <option value="out">Stok Habis</option>
        <option value="available">Stok Tersedia</option>
      </select>

      <button class="btn-export" (click)="exportProducts()">ğŸ“„ Export Data</button>
    </div>
  </div>

  <!-- Statistik Produk -->
  <div class="products-stats">
    <div class="stat-card">
      <div class="stat-number">{{ totalProducts }}</div>
      <div class="stat-label">Total Produk</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ lowStockProducts }}</div>
      <div class="stat-label">Stok Rendah</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ outOfStockProducts }}</div>
      <div class="stat-label">Stok Habis</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">Rp {{ totalInventoryValue.toLocaleString('id-ID') }}</div>
      <div class="stat-label">Nilai Inventori</div>
    </div>
  </div>

  <!-- Daftar Produk -->
  <div class="products-table-section">
    <div class="table-header">
      <h3>Daftar Produk ({{ filteredProducts.length }} items)</h3>
      <div class="table-info">
        <span class="results-count"
          >Menampilkan {{ filteredProducts.length }} dari {{ totalProducts }} produk</span
        >
      </div>
    </div>

    <div *ngIf="filteredProducts.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“¦</div>
      <h4>Tidak ada produk yang ditemukan</h4>
      <p>Coba ubah filter pencarian atau tambahkan produk baru</p>
      <div class="empty-state-actions">
        <button class="btn-primary" (click)="goToAddProduct()">â• Tambah Produk Pertama</button>
        <button class="btn-secondary" (click)="startBarcodeScanner()">ğŸ“· Scan Barcode</button>
      </div>
    </div>

    <div class="products-grid" *ngIf="filteredProducts.length > 0">
      <div
        *ngFor="let product of filteredProducts"
        class="product-card"
        [class]="getStockStatusClass(product)"
      >
        <div class="product-header">
          <h4 class="product-name">{{ product.name }}</h4>
          <span class="product-barcode">ğŸ“Š {{ product.barcode }}</span>
        </div>

        <div class="product-details">
          <div class="detail-item">
            <span class="label">Kategori:</span>
            <span class="value">{{ product.category || 'Tidak ada kategori' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Harga Jual:</span>
            <span class="value price">Rp {{ product.price.toLocaleString('id-ID') }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Stok Tersedia:</span>
            <span class="value stock" [class]="getStockStatusClass(product) + '-text'">
              {{ product.stock }} pcs
            </span>
          </div>
          <div class="detail-item" *ngIf="product.minStock > 0">
            <span class="label">Stok Minimum:</span>
            <span class="value">{{ product.minStock }} pcs</span>
          </div>
          <div class="detail-item" *ngIf="product.supplier">
            <span class="label">Supplier:</span>
            <span class="value">{{ product.supplier }}</span>
          </div>
        </div>

        <div class="product-actions">
          <button class="btn-edit" (click)="editProduct(product)">âœï¸ Edit</button>
          <button
            class="btn-restock"
            (click)="showRestockModal(product)"
            *ngIf="product.stock <= (product.minStock || 5)"
          >
            ğŸ“¦ Restock
          </button>
          <button
            class="btn-quick-restock"
            (click)="quickRestock(product, 10)"
            *ngIf="product.stock > 0"
          >
            â• Quick +10
          </button>
          <button class="btn-delete" (click)="deleteProduct(product.id)">ğŸ—‘ï¸ Hapus</button>
        </div>

        <div class="stock-indicator" [class]="getStockStatusClass(product)"></div>
        <div class="stock-badge" [class]="getStockStatusClass(product) + '-badge'">
          {{ getStockText(product) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Scanner Barcode -->
  <div *ngIf="showBarcodeScanner" class="modal-overlay">
    <div class="modal-content scanner-modal">
      <h3>ğŸ“· Scan Barcode Produk</h3>

      <div class="scanner-container">
        <div id="barcode-scanner-container" class="scanner-viewport">
          <div *ngIf="!isScanning" class="scanner-placeholder">
            <div class="scanner-loading">ğŸ”„ Memuat kamera...</div>
          </div>
        </div>

        <div class="scanner-guide">
          <div class="scan-frame"></div>
          <p class="scan-instruction">Arahkan kamera ke barcode produk</p>
        </div>
      </div>

      <div *ngIf="scanError" class="scanner-error">
        <span class="error-icon">âš ï¸</span>
        {{ scanError }}
      </div>

      <div class="scanner-actions">
        <button class="btn-cancel" (click)="stopBarcodeScanner()">âœ• Tutup Scanner</button>
        <button class="btn-manual" (click)="manualBarcodeSearch(); stopBarcodeScanner()">
          ğŸ”¢ Input Manual
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Restock -->
  <div *ngIf="showRestock" class="modal-overlay">
    <div class="modal-content">
      <h3>ğŸ“¦ Restock Produk</h3>
      <p>
        <strong>{{ selectedProduct?.name }}</strong>
      </p>
      <p>
        Stok saat ini: <strong>{{ selectedProduct?.stock }} pcs</strong>
      </p>

      <div class="form-group">
        <label>Jumlah Tambahan Stok:</label>
        <input
          type="number"
          [(ngModel)]="restockQuantity"
          min="1"
          placeholder="Masukkan jumlah"
          class="form-input"
        />
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" (click)="cancelRestock()">Batal</button>
        <button class="btn-confirm" (click)="confirmRestock()">âœ… Konfirmasi Restock</button>
      </div>
    </div>
  </div>

  <!-- Modal Edit Produk -->
  <div *ngIf="showEdit" class="modal-overlay">
    <div class="modal-content edit-modal">
      <h3>âœï¸ Edit Produk</h3>

      <div class="form-group">
        <label>Nama Produk *</label>
        <input
          type="text"
          [(ngModel)]="editProductForm.name"
          placeholder="Nama produk"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>Barcode *</label>
        <div class="barcode-input-group">
          <input
            type="text"
            [(ngModel)]="editProductForm.barcode"
            placeholder="Kode barcode"
            class="form-input"
          />
          <button class="btn-scan-small" (click)="startBarcodeScanner()" type="button">ğŸ“·</button>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Kategori</label>
          <select [(ngModel)]="editProductForm.category" class="form-input">
            <option value="">Pilih Kategori</option>
            <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Harga (Rp) *</label>
          <input
            type="number"
            [(ngModel)]="editProductForm.price"
            min="0"
            placeholder="Harga"
            class="form-input"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Stok *</label>
          <input
            type="number"
            [(ngModel)]="editProductForm.stock"
            min="0"
            placeholder="Stok"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label>Stok Minimum</label>
          <input
            type="number"
            [(ngModel)]="editProductForm.minStock"
            min="0"
            placeholder="Stok minimum"
            class="form-input"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Supplier</label>
        <input
          type="text"
          [(ngModel)]="editProductForm.supplier"
          placeholder="Nama supplier"
          class="form-input"
        />
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" (click)="cancelEdit()">Batal</button>
        <button class="btn-confirm" (click)="updateProduct()">ğŸ’¾ Simpan Perubahan</button>
      </div>
    </div>
  </div>
</div>
