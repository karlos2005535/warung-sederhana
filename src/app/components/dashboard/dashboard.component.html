<!-- dashboard.component.html -->
<div class="dashboard-container">
  <!-- Header -->
  <header class="header">
    <div class="header-brand">
      <div class="logo">üõí</div>
      <div class="brand-info">
        <h1>Toko Pak Baco</h1>
        <span>Kios Sembako Khas Indonesia</span>
      </div>
    </div>

    <div class="header-actions">
      <div class="user-profile">
        <div class="user-avatar">{{ currentUser?.username?.charAt(0) }}</div>
        <span>Hi, {{ currentUser?.username }}</span>
      </div>
      <button class="menu-toggle" (click)="toggleMenu()">‚ò∞</button>
    </div>
  </header>

  <div class="main-layout">
    <!-- Sidebar -->
    <aside class="sidebar" [class.sidebar-open]="isMenuOpen">
      <nav class="sidebar-nav">
        <div *ngFor="let item of menuItems" class="nav-item" (click)="navigateTo(item.route)">
          <span class="nav-icon">{{ item.icon }}</span>
          <div class="nav-text">
            <strong>{{ item.title }}</strong>
            <small>{{ item.description }}</small>
          </div>
        </div>

        <div class="nav-divider"></div>

        <div class="nav-item logout" (click)="logout()">
          <span class="nav-icon">üö™</span>
          <div class="nav-text">
            <strong>Keluar</strong>
            <small>Logout dari sistem</small>
          </div>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <!-- Page Header -->
      <div class="page-header">
        <div class="header-content">
          <h1>Dashboard</h1>
          <p>{{ currentDate | date : 'fullDate' }}</p>
        </div>
        <button class="refresh-btn" (click)="refreshData()">üîÑ Refresh</button>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üí∞</div>
          <div class="stat-info">
            <h3>Rp {{ salesReport.todaySales.toLocaleString('id-ID') }}</h3>
            <p>Penjualan Hari Ini</p>
            <span class="trend" *ngIf="salesReport.todaySales > 0">
              ‚Üë {{ getSalesGrowth() }}% dari kemarin
            </span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üìà</div>
          <div class="stat-info">
            <h3>Rp {{ salesReport.monthlySales.toLocaleString('id-ID') }}</h3>
            <p>Penjualan Bulan Ini</p>
            <span class="trend"> {{ getDaysInMonth() }} hari </span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üì¶</div>
          <div class="stat-info">
            <h3>{{ salesReport.totalProducts }}</h3>
            <p>Total Produk</p>
            <span class="trend">{{ getTotalCategories() }} kategori</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚ö†Ô∏è</div>
          <div class="stat-info">
            <h3>{{ salesReport.lowStockItems }}</h3>
            <p>Stok Menipis</p>
            <span class="trend warning" *ngIf="salesReport.lowStockItems > 0">
              Perlu perhatian
            </span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üè™</div>
          <div class="stat-info">
            <h3>Rp {{ salesReport.inventoryValue.toLocaleString('id-ID') }}</h3>
            <p>Nilai Inventori</p>
            <span class="trend">Total aset</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üìã</div>
          <div class="stat-info">
            <h3>{{ getActiveDebtsCount() }}</h3>
            <p>Piutang Aktif</p>
            <span class="trend warning" *ngIf="getActiveDebtsCount() > 0"> Perlu penagihan </span>
          </div>
        </div>
      </div>

      <div class="content-grid">
        <!-- Stock Section -->
        <section class="card stock-section">
          <div class="card-header">
            <h2>üì¶ Status Stok</h2>
            <div class="card-actions">
              <button class="btn-secondary" (click)="navigateTo('/products-list')">
                Lihat Semua
              </button>
              <button class="btn-primary" (click)="navigateTo('/products')">+ Tambah Stok</button>
            </div>
          </div>

          <!-- Stock Filters -->
          <div class="filter-tabs">
            <button
              class="filter-tab"
              [class.active]="stockFilter === 'all'"
              (click)="setStockFilter('all')"
            >
              Semua ({{ stockData.length }})
            </button>
            <button
              class="filter-tab"
              [class.active]="stockFilter === 'low'"
              (click)="setStockFilter('low')"
            >
              Rendah ({{ getLowStockCount() }})
            </button>
            <button
              class="filter-tab"
              [class.active]="stockFilter === 'out'"
              (click)="setStockFilter('out')"
            >
              Habis ({{ getOutOfStockCount() }})
            </button>
          </div>

          <!-- Stock List -->
          <div class="stock-list">
            <div *ngIf="getFilteredStock().length === 0" class="empty-state">
              <div class="empty-icon">üì¶</div>
              <p>Tidak ada produk dengan status stok ini</p>
            </div>

            <div
              *ngFor="let item of getFilteredStock()"
              class="stock-item"
              [class]="getStockStatus(item.stock, item.minStock)"
              (click)="navigateToProduct(item.id)"
            >
              <div class="product-main">
                <span class="product-name">{{ item.name }}</span>
                <span class="product-category">{{ item.category }}</span>
              </div>
              <div class="product-details">
                <span class="stock">{{ item.stock }} pcs</span>
                <span class="price">Rp {{ item.price.toLocaleString('id-ID') }}</span>
              </div>
              <div class="stock-status">
                <span class="status-badge" [class]="getStockStatus(item.stock, item.minStock)">
                  {{ getStockText(item.stock, item.minStock) }}
                </span>
                <button
                  class="restock-btn"
                  *ngIf="item.stock <= (item.minStock || 5)"
                  (click)="$event.stopPropagation(); quickRestock(item)"
                >
                  + Restock
                </button>
              </div>
            </div>
          </div>

          <div class="stock-summary">
            <div class="summary-item">
              <span>Total:</span>
              <strong>{{ stockData.length }}</strong>
            </div>
            <div class="summary-item">
              <span>Rendah:</span>
              <strong class="warning">{{ getLowStockCount() }}</strong>
            </div>
            <div class="summary-item">
              <span>Habis:</span>
              <strong class="danger">{{ getOutOfStockCount() }}</strong>
            </div>
          </div>
        </section>

        <!-- Side Panel -->
        <div class="side-panel">
          <!-- Quick Actions -->
          <section class="card quick-actions">
            <div class="card-header">
              <h2>‚ö° Aksi Cepat</h2>
            </div>
            <div class="actions-grid">
              <button class="action-btn" (click)="navigateTo('/pos')">
                <span class="action-icon">üí∞</span>
                <span class="action-text">
                  <strong>Kasir</strong>
                  <small>Transaksi</small>
                </span>
              </button>

              <button class="action-btn" (click)="navigateTo('/products')">
                <span class="action-icon">‚ûï</span>
                <span class="action-text">
                  <strong>Tambah Barang</strong>
                  <small>Produk baru</small>
                </span>
              </button>

              <button class="action-btn" (click)="navigateTo('/products-list')">
                <span class="action-icon">üì¶</span>
                <span class="action-text">
                  <strong>Kelola Stok</strong>
                  <small>Semua produk</small>
                </span>
              </button>

              <button class="action-btn" (click)="navigateTo('/categories')">
                <span class="action-icon">üè∑Ô∏è</span>
                <span class="action-text">
                  <strong>Kategori</strong>
                  <small>Kelola kategori</small>
                </span>
              </button>

              <button class="action-btn" (click)="navigateTo('/debts')">
                <span class="action-icon">üìù</span>
                <span class="action-text">
                  <strong>Piutang</strong>
                  <small>Kelola piutang</small>
                </span>
              </button>
            </div>
          </section>

          <!-- Recent Sales -->
          <section class="card recent-sales">
            <div class="card-header">
              <h2>üïí Penjualan Terbaru</h2>
              <button class="btn-text" (click)="navigateTo('/reports')">Lihat Semua</button>
            </div>
            <div class="sales-list">
              <div *ngFor="let sale of getRecentSales()" class="sale-item">
                <div class="sale-time">{{ sale.date | date : 'HH:mm' }}</div>
                <div class="sale-details">
                  <span class="sale-amount">Rp {{ sale.total.toLocaleString('id-ID') }}</span>
                  <span class="sale-items">{{ sale.items?.length }} items</span>
                </div>
              </div>
              <div *ngIf="getRecentSales().length === 0" class="empty-state">
                <p>Belum ada transaksi hari ini</p>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>
  </div>
</div>
