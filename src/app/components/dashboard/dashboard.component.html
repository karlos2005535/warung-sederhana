<div class="dashboard-container">
  <div class="backdrop" [class.show]="isMenuOpen" (click)="isMenuOpen = false"></div>

  <aside class="sidebar" [class.open]="isMenuOpen">
    <div class="sidebar-header">
      <div class="logo-icon">ğŸ›’</div>
      <div class="brand">
        <h1>WarungKita</h1>
        <span>Dashboard Admin</span>
      </div>
    </div>

    <nav class="nav-scroll">
      <div *ngFor="let item of menuItems" class="nav-item" (click)="navigateTo(item.route)">
        <span class="nav-icon">{{ item.icon }}</span>
        <div class="nav-content">
          <strong>{{ item.title }}</strong>
          <small>{{ item.description }}</small>
        </div>
      </div>

      <div class="nav-item logout" (click)="logout()">
        <span class="nav-icon">ğŸšª</span>
        <div class="nav-content">
          <strong>Keluar</strong>
          <small>Akhiri sesi</small>
        </div>
      </div>
    </nav>
  </aside>

  <main class="main-content">
    <header class="top-bar">
      <div style="display: flex; align-items: center; gap: 1rem">
        <button class="menu-btn" (click)="toggleMenu()">â˜°</button>
        <div class="greeting">
          <h2>Halo, {{ currentUser?.username || 'Admin' }}! ğŸ‘‹</h2>
          <p>{{ currentDate | date : 'EEEE, d MMMM y' }} &bull; Selamat bekerja.</p>
        </div>
      </div>

      <div class="user-actions">
        <button class="refresh-btn" (click)="refreshData()">
          ğŸ”„ <span class="d-none-mobile">Refresh Data</span>
        </button>
        <div class="avatar" title="User Profile">
          {{ currentUser?.username?.charAt(0) | uppercase }}
        </div>
      </div>
    </header>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <div class="icon-box blue">ğŸ’°</div>
          <span class="trend positive">â†‘ {{ getSalesGrowth() }}%</span>
        </div>
        <h3>Rp {{ salesReport.todaySales.toLocaleString('id-ID') }}</h3>
        <p>Penjualan Hari Ini</p>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="icon-box green">ğŸ“ˆ</div>
          <span class="trend neutral">Bulan Ini</span>
        </div>
        <h3>Rp {{ salesReport.monthlySales.toLocaleString('id-ID') }}</h3>
        <p>Total Omset Bulanan</p>
      </div>

      <div class="stat-card" [style.border-color]="salesReport.lowStockItems > 0 ? '#fca5a5' : ''">
        <div class="stat-header">
          <div
            class="icon-box"
            [class.red]="salesReport.lowStockItems > 0"
            [class.orange]="salesReport.lowStockItems === 0"
          >
            âš ï¸
          </div>
          <span class="trend negative" *ngIf="salesReport.lowStockItems > 0">Perlu Restock</span>
        </div>
        <h3>{{ salesReport.lowStockItems }} Item</h3>
        <p>Stok Menipis / Habis</p>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="icon-box orange">ğŸ¦</div>
          <span class="trend neutral">Aset</span>
        </div>
        <h3>Rp {{ salesReport.inventoryValue.toLocaleString('id-ID') }}</h3>
        <p>Total Nilai Aset</p>
      </div>
    </div>

    <div class="content-wrapper">
      <section class="card stock-section">
        <div class="card-header">
          <h2>ğŸ“¦ Status Persediaan</h2>
          <button class="btn-link" (click)="navigateTo('/products')">+ Tambah Barang</button>
        </div>

        <div class="tabs">
          <button [class.active]="stockFilter === 'all'" (click)="setStockFilter('all')">
            Semua
          </button>
          <button [class.active]="stockFilter === 'low'" (click)="setStockFilter('low')">
            Menipis <span *ngIf="getLowStockCount() > 0">({{ getLowStockCount() }})</span>
          </button>
          <button
            [class.active]="stockFilter === 'out'"
            (click)="setStockFilter('out')"
            style="color: var(--danger)"
          >
            Habis <span *ngIf="getOutOfStockCount() > 0">({{ getOutOfStockCount() }})</span>
          </button>
        </div>

        <div class="stock-list">
          <div
            *ngIf="getFilteredStock().length === 0"
            style="padding: 2rem; text-align: center; color: var(--text-muted)"
          >
            <p>Tidak ada data untuk filter ini.</p>
          </div>

          <div
            class="item-row"
            *ngFor="let item of getFilteredStock()"
            (click)="navigateToProduct(item.id)"
          >
            <div class="info">
              <span class="name">{{ item.name }}</span>
              <span class="cat">{{ item.category }}</span>
            </div>

            <div class="meta">
              <div style="text-align: right">
                <div class="price">Rp {{ item.price.toLocaleString('id-ID') }}</div>
                <div class="qty">Sisa: {{ item.stock }}</div>
              </div>

              <span
                class="badge"
                [class.normal]="item.stock > (item.minStock || 5)"
                [class.low]="item.stock <= (item.minStock || 5) && item.stock > 0"
                [class.out]="item.stock === 0"
              >
                {{ getStockText(item.stock, item.minStock) }}
              </span>

              <button
                class="btn-sm-primary"
                *ngIf="item.stock <= (item.minStock || 5)"
                (click)="$event.stopPropagation(); quickRestock(item)"
              >
                Restock
              </button>
            </div>
          </div>
        </div>
      </section>

      <aside style="display: flex; flex-direction: column; gap: 1.5rem">
        <div class="card">
          <div class="card-header">
            <h2>âš¡ Akses Cepat</h2>
          </div>
          <div class="quick-actions-grid">
            <div class="action-btn" (click)="navigateTo('/pos')">
              <span class="icon">ğŸ–¥ï¸</span>
              <span>Kasir</span>
            </div>
            <div class="action-btn" (click)="navigateTo('/products-list')">
              <span class="icon">ğŸ”</span>
              <span>Cek Stok</span>
            </div>
            <div class="action-btn" (click)="navigateTo('/debts')">
              <span class="icon">ğŸ“’</span>
              <span>Piutang</span>
            </div>
            <div class="action-btn" (click)="navigateTo('/reports')">
              <span class="icon">ğŸ“Š</span>
              <span>Laporan</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>ğŸ•’ Transaksi Terakhir</h2>
            <button class="btn-link" (click)="navigateTo('/reports')">Detail</button>
          </div>
          <div class="recent-sales-list">
            <div
              *ngIf="getRecentSales().length === 0"
              style="
                padding: 1.5rem;
                text-align: center;
                color: var(--text-muted);
                font-size: 0.9rem;
              "
            >
              Belum ada transaksi hari ini.
            </div>

            <div class="sale-item" *ngFor="let sale of getRecentSales()">
              <div class="sale-icon">ğŸ§¾</div>
              <div class="sale-info">
                <span class="amount">Rp {{ sale.total.toLocaleString('id-ID') }}</span>
                <span class="items">{{ sale.items.length }} Barang</span>
              </div>
              <span class="time">{{ sale.date | date : 'HH:mm' }}</span>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>
</div>
